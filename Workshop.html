<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-04-18 Thu 01:28 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Having your Raspberry Pi and Sharing it Too</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Jim Klassen, Bob Basques" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Having your Raspberry Pi and Sharing it Too</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgfcc04b0">1. Introduction</a>
<ul>
<li><a href="#org71fcd53">1.1. Background</a></li>
<li><a href="#org1bbc9a5">1.2. Goal</a></li>
</ul>
</li>
<li><a href="#org20630fe">2. Install Raspbian Full 2019-04 to a SD Card</a>
<ul>
<li><a href="#org652a49b">2.1. Download a Raspbian image</a></li>
<li><a href="#org734ea67">2.2. Copy Image to SD Card</a></li>
<li><a href="#org8e5a3c9">2.3. First Boot</a></li>
<li><a href="#org8df0725">2.4. Enable SSH</a></li>
<li><a href="#org430f239">2.5. Next steps</a></li>
</ul>
</li>
<li><a href="#orgba18c25">3. Creating a Stand alone WiFi access point</a>
<ul>
<li><a href="#org56e838a">3.1. Open a terminal</a></li>
<li><a href="#orgf7d4220">3.2. Install HostAPd</a></li>
<li><a href="#org5617017">3.3. Install  DNSMASQ (DHCP server)</a></li>
<li><a href="#org0f3ab60">3.4. Configure the network interfaces</a></li>
<li><a href="#org14d4181">3.5. Give your Pi a hostname</a></li>
<li><a href="#org555989e">3.6. Restart your Pi</a></li>
<li><a href="#org51d9508">3.7. Now you should be able to connect to your Pi via WiFi</a></li>
</ul>
</li>
<li><a href="#org2957fc2">4. Installing GeoMoose</a>
<ul>
<li><a href="#org71ea4de">4.1. Again get a root shell</a></li>
<li><a href="#org90e788b">4.2. Install Apache</a></li>
<li><a href="#org992aa4c">4.3. Install Mapserver (and friends)</a></li>
<li><a href="#org590a350">4.4. Install PostGIS (if you want to)</a></li>
<li><a href="#org3d57fdf">4.5. Install GeoMoose</a>
<ul>
<li><a href="#org2260759">4.5.1. Download and unzip GeoMoose</a></li>
<li><a href="#org2d61e0e">4.5.2. Configure GeoMoose for the install paths</a></li>
<li><a href="#org6eae24e">4.5.3. Test GeoMoose</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5675bad">5. Final Touches</a>
<ul>
<li><a href="#org5dced74">5.1. Shutdown CGI Script</a></li>
<li><a href="#org3a3a22a">5.2. Install a Firewall</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgfcc04b0" class="outline-2">
<h2 id="orgfcc04b0"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org71fcd53" class="outline-3">
<h3 id="org71fcd53"><span class="section-number-3">1.1</span> Background</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The Raspberry Pi is a credit card sized computer produced by the
Raspberry Pi Foundation.  We will focus on the current top of the
line model, the 3B+, which has a 1.2 GHz 4-core ARM v8 processor,
1GB of RAM, and built in WiFi, Bluetooth, HDMI, and Ethernet.
</p>

<p>
This isn't powerful by modern PC standards, but it is still plenty
capable of being a miniature server.
</p>

<p>
The primary operating system is Raspbian which is a Debian Linux
derivative, although other Linux distributions such as Arch,
Fedora, and Ubuntu are available.  Other operating systems such as
FreeBSD, RISC OS, etc. are also available.  We will stick with
Raspbian for this workshop because it is the most common and best
supported.
</p>

<p>
The important point though is after some hardware specific setup
steps, the Raspberry Pi is essentially a standard GNU/Linux system
and much of what you may know about working with GNU/Linux systems
will equally apply to the Pi.  The main differences compared to a
standard x86 desktop or server are the limited RAM, and slower
storage.  Also keep in mind that this is an ARM processor so x86
binaries will not run (although this tends not to be a problem in
the FOSS ecosystem were you can freely recompile programs for your
computer.)  In any case, you will likely find most of what you need
is already included in Raspbian.
</p>
</div>
</div>

<div id="outline-container-org1bbc9a5" class="outline-3">
<h3 id="org1bbc9a5"><span class="section-number-3">1.2</span> Goal</h3>
<div class="outline-text-3" id="text-1-2">
<p>
The goal of this workshop is to learn how to setup a Raspberry Pi
to be a miniature server you can take with you into the field.  At
the end of the workshop you will have a Raspberry Pi that acts as a
stand alone 802.11 access point that users can connect to with
their normal client devices (phones, tablets, laptops, etc.).
</p>

<p>
To have a concrete example, we will install the GeoMoose 3 demo
(which includes Apache, MapServer, and optionally PostGIS).  The
intent though is to show you how you might approach building such a
system, with whatever FOSS stack you need for purposes, rather than
focus on GeoMoose.
</p>
</div>
</div>
</div>

<div id="outline-container-org20630fe" class="outline-2">
<h2 id="org20630fe"><span class="section-number-2">2</span> Install Raspbian Full 2019-04 to a SD Card</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org652a49b" class="outline-3">
<h3 id="org652a49b"><span class="section-number-3">2.1</span> Download a Raspbian image</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Raspbian is the default operating system on the Raspberry Pi.  It
is essentially a port of Debian to the Raspberry Pi devices with some
tweaks to optimize it for the Raspberry Pi hardware and to make it a
easier to use out of the box.
</p>

<p>
Raspbian can be downloaded at: [<a href="https://www.raspberrypi.org/downloads/raspbian/">https://www.raspberrypi.org/downloads/raspbian/</a>]
</p>

<p>
The Raspberry Pi foundation currently provides 3 choices of Raspbian images: 
</p>
<ul class="org-ul">
<li>Full (includes desktop and recommended software)</li>
<li>Desktop (includes the desktop)</li>
<li>Lite (a command line only minimal image)</li>
</ul>

<p>
The primary difference between the images is what software is
installed by default in the image.
</p>

<p>
For the purposes of this workshop, we are going with the Full image
because it provides the best experience for getting started with
the Raspberry Pi.
</p>

<p>
For an actual server deployment, the Lite image would be more
appropriate to avoid installing a bunch of software you don't need,
and then install only what you need.
</p>
</div>
</div>

<div id="outline-container-org734ea67" class="outline-3">
<h3 id="org734ea67"><span class="section-number-3">2.2</span> Copy Image to SD Card</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Once you have the Raspbian image downloaded, you will find a <code>.img</code>
file inside a <code>.zip</code> file.  This <code>.img</code> file needs to be copied
onto a SD card to boot the Pi.
</p>

<p>
Note this is a disk image, not a "file" so you need a special tool
to copy it to the SD card.  The Raspberry Pi Foundation provides
recommendations for doing this <a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md">here</a>.
</p>

<p>
If you are on a Linux (or Linux like) operating system you can also
use the <code>dd</code> command to copy the <code>.img</code> to the corresponding raw
device (being careful to not overwrite the wrong device on your
computer). (e.g.: <code>sudo dd if=2019-04-08-raspbian-stretch-full.img
   of=/dev/mmcblk0 bs=1M oflag=direct</code>)
</p>

<p>
This image contains two partitions: A FAT32 partition with the boot
files, and an ext4 partition with the Linux filesystem.  Note: if
you are looking at the card on a non-Linux machine, you likely
won't be able to see the files on the ext4 partition.
</p>
</div>
</div>

<div id="outline-container-org8e5a3c9" class="outline-3">
<h3 id="org8e5a3c9"><span class="section-number-3">2.3</span> First Boot</h3>
<div class="outline-text-3" id="text-2-3">
<p>
On the first boot of freshly installed Raspbian on the Raspberry
Pi it will ask a number of questions such as what keyboard layout,
country (sets internationalization and WiFi channels), setup a
network connection, change the default password, and to install
updates.
</p>

<p>
To do answer these questions, it is easiest to plug the Pi into a
HDMI monitor and USB keyboard and mouse.
</p>
</div>
</div>

<div id="outline-container-org8df0725" class="outline-3">
<h3 id="org8df0725"><span class="section-number-3">2.4</span> Enable SSH</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Now is a good time to enable SSH access to your Pi.  This will allow you
to get a remote secure shell as well as make it easier to transfer files
with scp/sftp.
</p>

<p>
This can be done from the desktop by going to the Pi menu then:
</p>
<ol class="org-ol">
<li>Open Preferences-&gt;Raspberry Pi Configuration</li>
<li>Click the Interfaces Tab</li>
<li>Enable SSH</li>
<li>Click OK</li>
</ol>

<p>
Alternatively, from a command prompt:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo raspi-config
</pre>
</div>

<p>
Then select <code>5 Interfacing Options</code>, then <code>P2 SSH</code>, then <code>YES</code>.
</p>
</div>
</div>

<div id="outline-container-org430f239" class="outline-3">
<h3 id="org430f239"><span class="section-number-3">2.5</span> Next steps</h3>
<div class="outline-text-3" id="text-2-5">
<p>
At this point the Pi is basically setup and you can explore it.
The next step will be to install the software needed and configure
it as a miniature server.
</p>
</div>
</div>
</div>

<div id="outline-container-orgba18c25" class="outline-2">
<h2 id="orgba18c25"><span class="section-number-2">3</span> Creating a Stand alone WiFi access point</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org56e838a" class="outline-3">
<h3 id="org56e838a"><span class="section-number-3">3.1</span> Open a terminal</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We need to type commands into the Pi to install and configure the
WiFi access point and associated software.  Since we are making
system level change, we need to be root (the administrative user).
To do this enter:
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo su
</pre>
</div>

<p>
At the prompt.
</p>

<p>
The prompt should change from ending with a <code>$</code> to ending with <code>#</code>
to indicate you are root.
</p>
</div>
</div>


<div id="outline-container-orgf7d4220" class="outline-3">
<h3 id="orgf7d4220"><span class="section-number-3">3.2</span> Install HostAPd</h3>
<div class="outline-text-3" id="text-3-2">
<p>
(Roughly following the instructions at:
<a href="https://frillip.com/using-your-raspberry-pi-3-as-a-wifi-access-point-with-hostapd/">https://frillip.com/using-your-raspberry-pi-3-as-a-wifi-access-point-with-hostapd/</a>)
</p>

<div class="org-src-container">
<pre class="src src-sh">apt install hostapd
zcat /usr/share/doc/hostapd/examples/hostapd.conf.gz &gt; /etc/hostapd/hostapd.conf
</pre>
</div>

<p>
Edit /etc/hostapd/hostapd.conf and set:
</p>
<ul class="org-ul">
<li><code>ssid=&lt;whatever you want&gt;</code></li>
<li><code>driver=nl80211</code></li>
<li><code>ieee80211n=1</code></li>
<li><code>wpa=2</code></li>
<li><code>wpa_passphrase=&lt;whatever you want&gt;</code></li>
<li><code>wpa_key_mgmt=WPA-PSK</code></li>
<li><code>wpa_pairwise=TKIP CCMP</code></li>
<li><code>rsn_pairwise=CCMP</code></li>
</ul>

<p>
Test hostapd configuration:
</p>
<div class="org-src-container">
<pre class="src src-sh">hostapd -d /etc/hostapd/hostapd.conf
</pre>
</div>

<p>
If it worked, you should see a bunch of log messages scrolling by
as it sets up the access point.  Type <code>Control-C</code> to exit.
</p>

<pre class="example">
random: Trying to read entropy from /dev/random
Configuration file: /etc/hostapd/hostapd.conf
ctrl_interface_group=0
nl80211: TDLS supported
nl80211: Supported cipher 00-0f-ac:1
nl80211: Supported cipher 00-0f-ac:5
nl80211: Supported cipher 00-0f-ac:2
nl80211: Supported cipher 00-0f-ac:4
nl80211: Supported cipher 00-0f-ac:6
...
wlan0: Event CHANNEL_LIST_CHANGED (29) received
nl80211: Drv Event 33 (NL80211_CMD_TRIGGER_SCAN) received for wlan0
wlan0: nl80211: Scan trigger
wlan0: Event SCAN_STARTED (48) received
Unknown event 48
VLAN: RTM_NEWLINK: ifi_index=3 ifname=wlan0 ifi_family=0 ifi_flags=0x11043 ([UP][RUNNING][LOWER_UP])
VLAN: vlan_newlink(wlan0)
RTM_NEWLINK: ifi_index=3 ifname=wlan0 operstate=6 linkmode=0 ifi_family=0 ifi_flags=0x11043 ([UP][RUNNING][LOWER_UP])
</pre>

<p>
If it didn't work it there will be error/failed messages and it
will return you to the prompt.
</p>

<pre class="example">
Configuration file: /etc/hostapd/hostapd.conf
Line 3: invalid line 'foo'
ctrl_interface_group=0
1 errors found in configuration file '/etc/hostapd/hostapd.conf'
Failed to set up interface with /etc/hostapd/hostapd.conf
hostapd_init: free iface 0x1144cf8
Failed to initialize interface
root@raspberrypi:/home/pi# 
</pre>
</div>
</div>

<div id="outline-container-org5617017" class="outline-3">
<h3 id="org5617017"><span class="section-number-3">3.3</span> Install  DNSMASQ (DHCP server)</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-sh">apt install dnsmasq
</pre>
</div>

<p>
Create /etc/dnsmasq.d/wlan0.conf:
</p>
<pre class="example">
interface=wlan0

#no-resolv
local=/pinet/
address=/pinet/192.168.99.1
dhcp-range=192.168.99.2,192.168.99.254,1h
dhcp-authoritative
</pre>
</div>
</div>

<div id="outline-container-org0f3ab60" class="outline-3">
<h3 id="org0f3ab60"><span class="section-number-3">3.4</span> Configure the network interfaces</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Edit /etc/network/interfaces:
</p>
<div class="org-src-container">
<pre class="src src-sh">allow-hotplug eth0
iface eth0 inet dhcp

allow-hotplug wlan0
iface wlan0 inet static
  hostapd /etc/hostapd/hostapd.conf
  address 192.168.99.1
  netmask 255.255.255.0
  network 192.168.99.0
  broadcast 192.168.99.255
</pre>
</div>

<p>
And start the interfaces:
</p>

<div class="org-src-container">
<pre class="src src-sh">ifup eth0
ifup wlan0
</pre>
</div>
</div>
</div>

<div id="outline-container-org14d4181" class="outline-3">
<h3 id="org14d4181"><span class="section-number-3">3.5</span> Give your Pi a hostname</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Edit <code>/etc/hosts</code>
</p>

<pre class="example">
192.168.99.1	raspberrypi raspberrypi.pinet
</pre>
</div>
</div>

<div id="outline-container-org555989e" class="outline-3">
<h3 id="org555989e"><span class="section-number-3">3.6</span> Restart your Pi</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">
<pre class="src src-sh">reboot
</pre>
</div>
</div>
</div>

<div id="outline-container-org51d9508" class="outline-3">
<h3 id="org51d9508"><span class="section-number-3">3.7</span> Now you should be able to connect to your Pi via WiFi</h3>
</div>
</div>

<div id="outline-container-org2957fc2" class="outline-2">
<h2 id="org2957fc2"><span class="section-number-2">4</span> Installing GeoMoose</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org71ea4de" class="outline-3">
<h3 id="org71ea4de"><span class="section-number-3">4.1</span> Again get a root shell</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Open a terminal (or connect via <code>ssh pi@192.168.99.1</code> or <code>ssh
   pi@raspberrypi.pinet</code>)
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo su
</pre>
</div>
</div>
</div>

<div id="outline-container-org90e788b" class="outline-3">
<h3 id="org90e788b"><span class="section-number-3">4.2</span> Install Apache</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-sh">apt install apache2
a2enmod cgi
systemctl stop apache2
systemctl start apache2
</pre>
</div>
</div>
</div>

<div id="outline-container-org992aa4c" class="outline-3">
<h3 id="org992aa4c"><span class="section-number-3">4.3</span> Install Mapserver (and friends)</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-sh">apt install cgi-mapserver mapserver-bin gdal-bin proj-bin
</pre>
</div>
</div>
</div>

<div id="outline-container-org590a350" class="outline-3">
<h3 id="org590a350"><span class="section-number-3">4.4</span> Install PostGIS (if you want to)</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">
<pre class="src src-sh">apt install postgis
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d57fdf" class="outline-3">
<h3 id="org3d57fdf"><span class="section-number-3">4.5</span> Install GeoMoose</h3>
<div class="outline-text-3" id="text-4-5">
</div>
<div id="outline-container-org2260759" class="outline-4">
<h4 id="org2260759"><span class="section-number-4">4.5.1</span> Download and unzip GeoMoose</h4>
<div class="outline-text-4" id="text-4-5-1">
<div class="org-src-container">
<pre class="src src-sh">mkdir -p /srv/geomoose
<span style="color: #483d8b;">cd</span> /srv/geomoose
wget https://www.geomoose.org/downloads/gm3-examples-3.3.0.zip
wget https://www.geomoose.org/downloads/gm3-demo-data-3.3.0.zip

unzip gm3-examples-3.3.0.zip
unzip gm3-demo-data-3.3.0.zip
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d61e0e" class="outline-4">
<h4 id="org2d61e0e"><span class="section-number-4">4.5.2</span> Configure GeoMoose for the install paths</h4>
<div class="outline-text-4" id="text-4-5-2">
<p>
Setup <code>/srv/geomoose/gm3-examples/htdocs/desktop/config.js</code>:    
</p>
<div class="org-src-container">
<pre class="src src-js">CONFIG = {
    mapserver_url: <span style="color: #8b2252;">'/cgi-bin/mapserv'</span>,
    mapfile_root: <span style="color: #8b2252;">'/srv/geomoose/gm3-demo-data/'</span>
};
</pre>
</div>

<p>
Add GeoMoose to the web-root:
</p>
<div class="org-src-container">
<pre class="src src-sh">ln -s /srv/geomoose/gm3-examples/htdocs /var/www/html/geomoose
</pre>
</div>
</div>
</div>

<div id="outline-container-org6eae24e" class="outline-4">
<h4 id="org6eae24e"><span class="section-number-4">4.5.3</span> Test GeoMoose</h4>
<div class="outline-text-4" id="text-4-5-3">
<p>
<a href="http://192.168.99.1/geomoose/desktop/">http://192.168.99.1/geomoose/desktop/</a>
</p>

<p>
or
</p>

<p>
<a href="http://raspberrypi.pinet/geomoose/desktop/">http://raspberrypi.pinet/geomoose/desktop/</a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org5675bad" class="outline-2">
<h2 id="org5675bad"><span class="section-number-2">5</span> Final Touches</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org5dced74" class="outline-3">
<h3 id="org5dced74"><span class="section-number-3">5.1</span> Shutdown CGI Script</h3>
<div class="outline-text-3" id="text-5-1">
<p>
When running the Raspberry Pi headless, you can usually get by just
unplugging the power when it is time to turn it off as long as it
wasn't busy doing something at the time.  However, it is safer to 
tell the OS to do a proper shutdown.
</p>

<p>
Shutdown-cgi is a simple C program that can be called from Apache
as a CGI script and executes the "halt -p" command to shutdown the
Pi.  After running this command, you will see the green light next
to the USB power-in plug blink for awhile as the Pi gets ready to
shutdown.  The green light will go out after it is done and it is
safe to remove power.
</p>

<p>
Note: shutdown-cgi is a C program instead of a shell (or other)
script because it needs to be installed set-UID so it can run as
root and have permissions to execute "halt".  Scripts don't honor
the set-uid bit.
</p>

<p>
To install shutdown-cgi run <code>sudo make install</code> from the
shutdown-cgi directory.
</p>

<p>
Then you can shutdown your Pi by going to the following URL:
</p>

<p>
[<a href="http://192.168.99.1/cgi-bin/shutdown">http://192.168.99.1/cgi-bin/shutdown</a>]
</p>

<p>
or
</p>

<p>
[<a href="http://raspberrypi.pinet/cgi-bin/shutdown">http://raspberrypi.pinet/cgi-bin/shutdown</a>]
</p>

<p>
while connected to the Pi's WiFi network.
</p>
</div>
</div>

<div id="outline-container-org3a3a22a" class="outline-3">
<h3 id="org3a3a22a"><span class="section-number-3">5.2</span> Install a Firewall</h3>
<div class="outline-text-3" id="text-5-2">
<p>
This workshop is intended for small, trusted WiFi networks so a
firewall isn't strictly necessary.  However, security in layers is
a good thing, so you may want to install a firewall on the Pi to
limit unexpected connections.  A relatively easy one to configure
that is included in Raspbian is <code>ufw</code>.
</p>

<p>
It can be installed with:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install ufw
</pre>
</div>

<p>
An example of simple configuration:
</p>
<div class="org-src-container">
<pre class="src src-sh">ufw allow <span style="color: #8b2252;">"DNS"</span>
ufw allow 67
ufw allow <span style="color: #8b2252;">"SSH"</span>
ufw allow <span style="color: #8b2252;">"WWW Full"</span>
ufw enable
</pre>
</div>

<p>
The first two lines allow DNS and DHCP queries from WiFi clients to
the Pi.  The next two lines allow SSH and HTTP access.  Then the
final line enables the firewall and sets it to be enabled at boot.
</p>

<p>
Of course, the rules you need will vary depending on your needs.
You could also tighten up access to only specific IP ranges, etc.
</p>

<p>
If you are connected to your Pi over the network, be careful you
don't lock yourself out.  If you do, you will need a monitor and
keyboard to fix it (or to edit the SD card in a different Linux
computer).
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2019-04-18 Thu 00:00</p>
<p class="author">Author: Jim Klassen, Bob Basques</p>
<p class="date">Created: 2019-04-18 Thu 01:28</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
